<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="../frontend/assets/sesionDoce.js"></script>
    <title>Document</title>
</head>

<body>
    <!-- component -->
    <!DOCTYPE html>
    <html lang="es">

    <head>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            /* Agregar estilos para la vista de dispositivos pequeños */
            @media (max-width: 768px) {
                .flex-wrap {
                    display: flex;
                    flex-wrap: wrap;
                }

                .section-small {
                    width: 50%;
                }
            }
        </style>
    </head>

    <body>
        <div class="flex flex-col h-screen ">

            <!-- Barra de navegación superior -->
            <div class="bg-gray-100 text-white shadow w-full p-2 flex items-center justify-between">
                <div class="flex items-center">
                    <div class="hidden md:flex items-center"> <!-- Se oculta en dispositivos pequeños -->

                        <h2 class="font-bold text-xl text-gray-500">Nombre de la Aplicación</h2>
                    </div>
                    <div class="md:hidden flex items-center"> <!-- Se muestra solo en dispositivos pequeños -->
                        <button id="menuBtn">
                            <i class="fas fa-bars text-gray-500 text-lg"></i> <!-- Ícono de menú -->
                        </button>
                    </div>
                </div>

                <div class="space-x-5">
                </div>
            </div>
            <!-- Contenido principal -->
            <div class="flex-1 flex">
                <!-- Barra lateral de navegación (oculta en dispositivos pequeños) -->
                <div class="p-2 bg-gray-100 w-60 flex flex-col hidden md:flex" id="sideNav">
                    <nav>
                        <a class="block text-gray-500 py-2.5 px-4 my-4 rounded transition duration-200 hover:bg-gradient-to-r hover:from-cyan-400 hover:to-cyan-300 hover:text-white"
                            href="../frontend/Vista_Select_Prueba_Doce.html">
                            <i class="fas fa-users mr-2"></i>Asignar prueba
                        </a>
                        <a class="block text-gray-500 py-2.5 px-4 my-4 rounded transition duration-200 hover:bg-gradient-to-r hover:from-cyan-400 hover:to-cyan-300 hover:text-white"
                            href="../frontend/Vista_Calificar_Doce.html">
                            <i class="fas fa-file-alt mr-2"></i>Calificar
                        </a>
                        <a class="block text-gray-500 py-2.5 px-4 my-4 rounded transition duration-200 hover:bg-gradient-to-r hover:from-cyan-400 hover:to-cyan-300 hover:text-white"
                            href="../frontend/Vista_Notas_Doce.html">
                            <i class="fas fa-file-alt mr-2"></i>Ver notas
                        </a>
                        <a class="block text-gray-500 py-2.5 px-4 my-4 rounded transition duration-200 hover:bg-gradient-to-r hover:from-cyan-400 hover:to-cyan-300 hover:text-white"
                            href="../frontend/Vista_Crear_Grupo_Doce.html">
                            <i class="fas fa-users mr-2"></i>Crear grupo
                        </a>
                        <!-- Ítem de Cerrar Sesión -->
                        <a id="logoutBtn"
                            class="block text-gray-500 py-2.5 px-4 my-2 rounded transition duration-200 hover:bg-gradient-to-r hover:from-red-400 hover:to-red-300 hover:text-white mt-auto"
                            href="#">
                            <i class="fas fa-sign-out-alt mr-2"></i>Cerrar sesión
                        </a>
                    </nav>



                    <!-- Señalador de ubicación -->
                    <div class="bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mt-2"></div>

                    <!-- Copyright al final de la navegación lateral -->
                    <p class="mb-1 px-5 py-3 text-left text-xs text-cyan-500">DSS COMPANY </p>

                </div>

                <!-- Área de contenido principal -->
                <div class="flex-1 p-4">

                    <!-- component -->
                    <div class="transition-colors duration-300">
                        <div class="container mx-auto p-4">
                            <div class="bg-white  shadow rounded-lg p-6">
                                <h1 class="text-xl font-semibold mb-4 text-gray-900 ">FactuEdu</h1>
                                <!-- Option -->

                                <form id="formSeccion">
                                    <!-- Nombre -->
                                    <p class="text-gray-600 mb-6">Escriba El nombre de la seccion</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <input type="text" id="nombreSeccion" placeholder="Nombre de la seccion"
                                            class="border p-2 rounded w-full" required>
                                    </div>

                                    <!-- Año -->
                                    <p class="text-gray-600 mb-6">Escriba El año de la seccion</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <input type="number" id="anioSeccion" placeholder="El año de la seccion"
                                            class="border p-2 rounded w-full" required>
                                    </div>

                                    <!-- Botón -->
                                    <button type="submit"
                                        class="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600 focus:outline-none transition-colors">
                                        Ingresar
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
        </div>

        <!-- Alert INCORRECTO -->
        <div class=" hidden top-4 left-1/2 -translate-x-1/2 z-50 font-regular w-full max-w-screen-md rounded-lg bg-red-400 bg-opacity-50 px-4 py-4 text-base text-white"
            data-dismissible="alert ">
            <!-- icono -->
            <div class="absolute top-4 left-4">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"
                    class="mt-px h-6 w-6">
                    <path fill-rule="evenodd"
                        d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z"
                        clip-rule="evenodd" />
                </svg>
            </div>

            <!-- texto -->
            <div class="ml-8 mr-12">
                <h5 class="text-xl font-semibold">Error 00010</h5>
                <p class="mt-2">Esta prueba ya se asigno</p>
            </div>

            <!-- botón de cierre (intacto) -->
            <div data-dismissible-target="alert" data-ripple-dark="true"
                class="absolute top-3 right-3 w-max rounded-lg transition-all hover:bg-white hover:bg-opacity-20">
                <div role="button" class="w-max rounded-lg p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </div>
            </div>
        </div>

        <div id="contenedor-secciones"></div>

        <!-- Modal oculto -->
        <div id="modal-matricula" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
            <div class="bg-white p-4 rounded">
                <h3 class="text-lg mb-2">Seleccione un alumno</h3>
                <ul id="lista-alumnos"></ul>
                <button id="cerrar-modal" class="mt-4 px-4 py-2 bg-gray-300 rounded">Cerrar</button>
            </div>
        </div>


    </body>

    </html>
</body>
<script src="../frontend/assets/cerrarSesion.js"></script>
<script>
    document.getElementById('formSeccion').addEventListener('submit', async function (e) {
        e.preventDefault();

        const nombre = document.getElementById('nombreSeccion').value;
        const anio = document.getElementById('anioSeccion').value;

        try {
            const response = await fetch('http://localhost:4000/secciones', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombre, anio })
            });

            const result = await response.json();

            if (response.ok) {
                alert('Sección guardada correctamente');
            } else {
                alert(result.message || 'Error al guardar sección');
            }
        } catch (error) {
            console.error('Error al guardar sección:', error);
            alert('Error al conectar con el servidor');
        }
    });
</script>
<script>
  const contenedor = document.getElementById('contenedor-secciones');
  const modal = document.getElementById('modal-matricula');
  const listaAlumnos = document.getElementById('lista-alumnos');
  let seccionActual = null;

  // 1) Cargar secciones al inicio
  async function cargarSecciones() {
    const res = await fetch('http://localhost:4000/seccionesListar', { credentials:'include' });
    const secciones = await res.json();
    contenedor.innerHTML = '';

    for (const sec of secciones) {
      const div = document.createElement('div');
      div.className = 'bg-white p-4 rounded-md mb-6';
      div.innerHTML = `
        <h2 class="text-gray-500 text-lg font-semibold pb-4">
          ${sec.nombre} (${sec.anio})
        </h2>
        <table class="w-full table-auto text-sm mb-2">
          <thead>
            <tr>
              <th class="px-4 py-2">Carnet</th>
              <th class="px-4 py-2">Nombre</th>
            </tr>
          </thead>
          <tbody id="int-body-${sec.id}">
            <tr><td colspan="2">Cargando...</td></tr>
          </tbody>
        </table>
        <button data-id="${sec.id}" class="matricular-btn px-4 py-2 bg-blue-500 text-white rounded">
          Matricular Usuario
        </button>
      `;
      contenedor.appendChild(div);
      cargarIntegrantes(sec.id);
    }

    // Asociar evento a todos los botones
    document.querySelectorAll('.matricular-btn')
      .forEach(btn => btn.addEventListener('click', abrirModal));
  }

  // 2) Cargar integrantes de una sección
  async function cargarIntegrantes(id) {
    const res = await fetch(`http://localhost:4000/secciones/${id}/integrantes`, { credentials:'include' });
    const ints = await res.json();
    const tbody = document.getElementById(`int-body-${id}`);
    tbody.innerHTML = ints.length
      ? ints.map(i => `<tr class="hover:bg-gray-100">
          <td class="border px-2 py-1 text-center">${i.id_alumno}</td>
          <td class="border px-2 py-1 text-center">${i.nombre_alumno}</td>
        </tr>`).join('')
      : `<tr><td colspan="2" class="text-center">No hay alumnos</td></tr>`;
  }

  // 3) Abrir modal y listar alumnos disponibles
  async function abrirModal(e) {
    seccionActual = e.target.dataset.id;
    modal.classList.remove('hidden');
    listaAlumnos.innerHTML = '<li>Cargando...</li>';

    const res = await fetch('http://localhost:4000/alumnos', { credentials:'include' });
    const alumnos = await res.json();
    listaAlumnos.innerHTML = alumnos.map(a => `
      <li class="flex justify-between items-center mb-2">
        <span>${a.codigo}</span>
        <button data-id="${a.id}" class="matricular-alumno px-2 py-1 bg-green-500 text-white rounded">
          Matricular
        </button>
      </li>
    `).join('');

    // Eventos de matriculación
    document.querySelectorAll('.matricular-alumno')
      .forEach(btn => btn.addEventListener('click', matricularAlumno));
  }

  // 4) Matricular alumno
  async function matricularAlumno(e) {
    const id_alumno = e.target.dataset.id;
    await fetch(`http://localhost:4000/secciones/${seccionActual}/matricular`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ id_alumno })
    });
    cargarIntegrantes(seccionActual);  // refresca la tabla
  }

  // 5) Cerrar modal
  document.getElementById('cerrar-modal').addEventListener('click', () => {
    modal.classList.add('hidden');
  });

  // Inicializamos
  cargarSecciones();
</script>


</html>